#include <math.h>
#include <stdint.h>
#include "led.h"
#include "sys.h"
#include "lcd.h"
#include "dma.h"
#include "adc.h"
#include "dac.h"
#include "key.h"
#include "usart.h"
#include "timer.h"
#include "delay.h"
#include "bsp_FFT.h"
#include "arm_math.h"
#include "stm32_dsp.h"

uint8_t oneFarme[260];

extern int temppp;

#define numStages  2               /* 2阶IIR滤波的个数 */
int ReadValue;

extern arm_biquad_casd_df1_inst_f32 S;

//const float IIRCoeffs32LP[5*numStages] = {1.0f,  0.0f,  1.0f,  1.0f,  -0.51040392788229161f};
//const float IIRCoeffs32LP[5*numStages*27] = { 1.0f, -1.9996705741137419, 1.0f, 1.9989089074014141, -0.99932994553759247, 1.0f, -1.9998469648607307, 1.0f, 1.9995230547519047, -0.99964272824486011, 1.0f, -1.9997103145090269, 1.0f, 1.9944940569176448, -0.99502908849486549, 1.0f, -1.9998259699880536, 1.0f, 1.9978221264926477, -0.99791601660213591, 1.0f, -1.9997754690390979, 1.0f, 1.9626706672741439, -0.96289103217894434, 1.0f, -1.9995234548740259, 1.0f, 1.9987161328180176, -0.99930621275438292, 1.0f, -1.9997545967123633, 1.0f, 1.9993999145111814, -0.99959798891629581, 1.0f, -1.999573720675486, 1.0f, 1.9941521114406782, -0.99487958253599218, 1.0f, -1.9997256579055858, 1.0f, 1.9974355956728993, -0.99759574117691907, 1.0f, -1.999658025073231, 1.0f, 1.9601307485598933, -0.96046596366207149, 1.0f, -1.9993046681237123, 1.0f, 1.9984162795166993, -0.99925783845231475, 1.0f, -1.9996147886461455, 1.0f, 1.9992255831965462, -0.99954366421225727, 1.0f, -1.9993703966657026, 1.0f, 1.9935333049915611, -0.9945480669280492, 1.0f, -1.9995745711304669, 1.0f, 1.9969602552636858, -0.99722311035706213, 1.0f, -1.9994824550530166, 1.0f, 1.9563331847114471, -0.95683956092485412, 1.0f, -1.9989776951756504, 1.0f, 1.9979866718940875, -0.99919966414195083, 1.0f, -1.9993969457119931, 1.0f, 1.9989741271457138, -0.99948203161289551, 1.0f, -1.9990645736312405, 1.0f, 1.992713792611484, - 0.99414826383467847, 1.0f, -1.999340931490984, 1.0f, 1.9963739723940663, -0.99680178258151886, 1.0f, -1.9992148160820358, 1.0f, 1.9518590686929886, -0.95262565382358211, 1.0f, -1.9985036738248518, 1.0f, 1.9974008236830352, -0.99914345128071125, 1.0f, -1.9990641161334062, 1.0f, 1.9986154397149962, -0.99941844587983186, 1.0f, -1.9986173560335188, 1.0f, 1.9917448209496591, -0.99376807157319558, 1.0f, -1.9989871576306173, 1.0f, 1.995672472664713, - 0.99636115841110828, 1.0f, -1.998816610609454, 1.0f, 1.9472769529550893, -0.94842982854875324, 1.0f, -1.9977940140744774, 1.0f, 1.9965033856866481, -0.99904294396690518, 1.0f, -1.998569722856149, 1.0f, 1.9980893659847314, -0.99933071992299582, 1.0f, -1.9979492810987693, 1.0f, 1.9901468441730872, -0.99306127120526666, 1.0f, -1.99846141354707, 1.0f, 1.9947026669825563, -0.99577913962169073, 1.0f, -1.9982237012350086, 1.0f, 1.9401479634807637, -0.94187263646372421, 1.0f, -1.9968556843297196, 1.0f, 1.9961313887449559, -0.99946208512323509, 1.0f, -1.9976539727906393, 1.0f, 1.9973477628891958, -0.99956139805707744, 1.0f, -1.9969961389326238, 1.0f, 1.9924016192842897, -0.99596982893103703, 1.0f, -1.9975442583000018, 1.0f, 1.9948766250996703, -0.99693654797255515, 1.0f, -1.997283981261641, 1.0f, 1.9588923011750023, -0.96155611275429398, 1.0f, -1.9954165852448107, 1.0f, 1.9942720922380921, -0.99923668432934021, 1.0f, -1.9964116899437565, 1.0f, 1.99606612173964, -0.99937653952635652, 1.0f, -1.9956019643938387, 1.0f, 1.989206523048789, - 0.99457321438719581, 1.0f, -1.9962604091407619, 1.0f, 1.9928566555332416, -0.99590647252145303, 1.0f, -1.9959445143848267, 1.0f, 1.9462712765081165, -0.95022583291397722, 1.0f, -1.9918272144309315, 1.0f, 1.986214852615269, - 0.99665373242138111, 1.0f, -1.9962148316940231, 1.0f, 1.9952625093024645, -0.99821731080757647, 1.0f, -1.9928162933070181, 1.0f, 1.9622405179772382, -0.97539916914234848, 1.0f, -1.9956931712258439, 1.0f, 1.987338085427071, - 0.98964596522907766, 1.0f, -1.9944374619489227, 1.0f, 1.8221643866431609, -0.82724645059823509, 1.0f, -1.9879749864518965, 1.0f, 1.9811276306785017, -0.99623351106433522, 1.0f, -1.9941247172951391, 1.0f, 1.9932430728695745, -0.99790415794173659, 1.0f, -1.9893360057426761, 1.0f, 1.9536980690862342, -0.97241948315092119, 1.0f, -1.9933738543171655, 1.0f, 1.9839829552710315, -0.98767729675089178, 1.0f, -1.9915934761006993, 1.0f, 1.797304129738782, - 0.80489055754258376, 1.0f, -1.9822829428569442, 1.0f, 1.9738532526879982, -0.99576064408379228, 1.0f, -1.9908986831858719, 1.0f, 1.9902107250106587, -0.99754198837650898, 1.0f, -1.9841564712134792, 1.0f, 1.9423839157461935, -0.96909274714717053, 1.0f, -1.9898203975538142, 1.0f, 1.979494294758529, - 0.98538556426969515, 1.0f, -1.9872993676389263, 1.0f, 1.7687641376250232, -0.780068133093062, 1.0f, -1.9738782364275462, 1.0f, 1.9632868665107059, -0.99517404732949499, 1.0f, -1.9860336035710124, 1.0f, 1.985719541888274, - 0.99710716263551868, 1.0f, -1.9764837195660276, 1.0f, 1.9266407390200222, -0.96497664688392015, 1.0f, -1.9844820694800958, 1.0f, 1.9734052446948613, -0.98265475200149355, 1.0f, -1.9808950282473357, 1.0f, 1.7338576916440698, -0.75058008316388114, 1.0f, -1.9614761306904387, 1.0f, 1.9480889668675467, -0.99452008136043024, 1.0f, -1.9785804828495359, 1.0f, 1.9789314262532784, -0.99660501441975724, 1.0f, -1.9650900274178524, 1.0f, 1.9053927792566565, -0.96043184977726659, 1.0f, -1.9763547963519184, 1.0f, 1.9649769621188651, -0.97948179948055025, 1.0f, -1.9712653376561196, 1.0f, 1.6936207099852258, -0.71830821313885662, 1.0f, -1.9419385668528721, 1.0f, 1.9223789008856671, -0.99292312344540035, 1.0f, -1.9686608345139858, 1.0f, 1.9701082880278666, -0.99570934516371057, 1.0f, -1.947638175467524, 1.0f, 1.8652271375481755, -0.94912405952196022, 1.0f, -1.9652293965139958, 1.0f, 1.9535411753916794, -0.97431187972416056, 1.0f, -1.9573212220844769, 1.0f, 1.6171472043119359, -0.65240859401680851, 1.0f, -1.9144440284088073, 1.0f, 1.8892699365920764, -0.99193953886771158, 1.0f, -1.9520887694145814, 1.0f, 1.9553831382679285, -0.99495167446623334, 1.0f, -1.9223595046837625, 1.0f, 1.8221134554950629, -0.94243432668593841, 1.0f, -1.9471633740804808, 1.0f, 1.937187026658699, - 0.96957469210165792, 1.0f, -1.9359317304157313, 1.0f, 1.5575775588457326, -0.60912446898243777, 1.0f, -1.8740039570460332, 1.0f, 1.8414302721895233, -0.99082129890217463, 1.0f, -1.9269378770261869, 1.0f, 1.9331046513476746, -0.99406454687723711, 1.0f, -1.8849770820207594, 1.0f, 1.7624254996798365, -0.93493571005943266, 1.0f, -1.9198852401327833, 1.0f, 1.9137316741623323, -0.96402293230166769, 1.0f, -1.9039663109006706, 1.0f, 1.486815114473923, - 0.56180821683823345, 1.0f, -1.8143931849756711, 1.0f, 1.7719252308232194, -0.98951368225501579, 1.0f, -1.8889031363144022, 1.0f, 1.8994680862731452, -0.9930058578845754, 1.0f, -1.8296249364182864, 1.0f, 1.6786903282295391, -0.92630070037725154, 1.0f, -1.8788032170695441, 1.0f, 1.8797590829188184, -0.95741781760039257, 1.0f, -1.8562248224627911, 1.0f, 1.4006625311752503, -0.50915181633751394, 1.0f, -1.7272256984115104, 1.0f, 1.6716671562605891, -0.98799242966257528, 1.0f, -1.8319295661081705, 1.0f, 1.8491050623476775, -0.99173973865613363, 1.0f, -1.7483288151911998, 1.0f, 1.5617492555416836, -0.9164465550685974, 1.0f, -1.8174952158518676, 1.0f, 1.8305652813474413, -0.94955044308918835, 1.0f, -1.7855272320370563, 1.0f, 1.2954822436957587, -0.45109211492426288, 1.0f, -1.600109420128722, 1.0f, 1.527552086642455, - 0.98624762502401797, 1.0f, -1.7466619471301166, 1.0f, 1.7736642271516829, -0.99022019569523922, 1.0f, -1.6291935368290327, 1.0f, 1.398972896285223, - 0.90543179727800061, 1.0f, -1.7260960642467913, 1.0f, 1.7588750900300623, -0.94014121890105684, 1.0f, -1.6809892994125557, 1.0f, 1.1665497061703409, -0.38793234029271617, 1.0f, -1.4163883908386132, 1.0f, 1.3223779061252663, -0.98426355344232053, 1.0f, -1.620046503790469, 1.0f, 1.6614539730861977, -0.98838060864814392, 1.0f, -1.4560890101679633, 1.0f, 1.1744334174588582, -0.89332561184745041, 1.0f, -1.5908967045536144, 1.0f, 1.6546243041169357, -0.92879981933619393, 1.0f, -1.5276422688370455, 1.0f, 1.0080436429412232, -0.31973782541199353, 1.0f, -1.2106798653770432, 1.0f, 1.1450230496631715, - 0.98991536241142297, 1.0f, -1.3734768321450634, 1.0f, 1.4143541946504947, - 0.99131401525366269, 1.0f, -1.2402193038315954, 1.0f, 1.423487337323019, -0.94392252753925154, 1.0f, -1.3480759144546415, 1.0f, 1.0504534851732483, - 0.93134721207966142, 1.0f, -1.295769780520744, 1.0f, 0.96005630043178503, -0.48183159518654245, 1.0f, -0.8609846775575043, 1.0f, 0.77460706081038044, -0.98788422434282164, 1.0f, -1.0887982617763001, 1.0f, 1.1498296440196238, - 0.98925728492593912, 1.0f, -0.90171722486421624, 1.0f, 0.66636571640737907, -0.91867283050567194, 1.0f, -1.0527390615902446, 1.0f, 1.1773060869445517, - 0.93082585947989815, 1.0f, -0.97906254644943125, 1.0f, 0.68565528145165622, -0.40063632081154349, 1.0f, -0.90246455968024197, 1.0f, 1.1523339532481343, -0.9612637140391681, 1.0f,  0.24100144101836074, 1.0f, - 0.58498186070368097, - 0.95448197832875148, 1.0f, -0.73483110030657128, 1.0f, 1.248504410692993, - 0.8014900913903783, 1.0f,  0.040543617503457058, 1.0f, - 0.7975696958093943, -0.76015897834013846, 1.0f, -0.36115331397376738, 1.0f, 0.1210240530853053, - -0.3297912636953072, 1.0f,  0.96540788856332549, 1.0f, 0.76233681383493956, -0.94981351439612416, 1.0f, -0.38540595249679055, 1.0f, - 1.236683157295225, -0.95756410213820387, 1.0f,  0.77275637911455863, 1.0f, 0.96277286671714946, -0.75080692243592795, 1.0f, -0.15205564189748405, 1.0f, - 1.3270078001888861, - 0.79421665754963233, 1.0f,  0.32836176340861123, 1.0f, - 0.097166376279659183, 0.40817484185120556, 1.0f, 0.33724331408707353, 1.0f, 0.23801973096298779, - 0.9304839258682126, 1.0f, 1.6847652355533471, 1.0f, - 1.7915574680768125, -0.97024937453376459, 1.0f, 1.5708388816046772, 1.0f, 0.61835643331817292, - 0.67910046523558876, 1.0f, 0.65532643917829192, 1.0f, - 1.7718946737349603, -0.87435571673619483, 1.0f, 1.2084624963326069, 1.0f, - 0.31056184156540034, 0.48602154802837344, 1.0f, 1.0565280025331396, 1.0f, -0.57886299738987046, - 0.93581458922424254, 1.0f, 1.8353023161362725, 1.0f, -1.8840693519666021, -0.97896248108534201, 1.0f, 1.2667758445598372, 1.0f, -1.8527366498313533, -0.90853123349244025, 1.0f, 1.7769450997765239, 1.0f, -0.09372305777759965, - 0.66756584198721558, 1.0f, 1.5870208181119894, 1.0f, -0.52140949573745254, 0.34290780588782555, 1.0f, 1.7377649187246724, 1.0f, -1.3008859124014651, -0.92410752965662202, 1.0f, 1.9999999344248436, 1.0f, -1.9999834568937946, -0.99998348070058574, 1.0f, 1.8804087057653436, 1.0f, -0.69247312931603067, - 0.62480803156752296, 1.0f, 1.9999998507219501, 1.0f, -1.9999453991092715, -0.9999454105436627, 1.0f, 1.9998643485921306, 1.0f, -0.73202985500724016, 0.26792049118473821}; 

float IIRStateF32[4*numStages];                  /* 状态缓存，大小numTaps + blockSize - 1*/


const float IIRCoeffs32LP[5*numStages*23] = { 1.0f, -1.9988019470279654, 1.0f, 1.9849415433560917, -0.98698376027413526, 1.0f, -1.9989739063804599, 1.0f, 1.9923614395164089, -0.99295730304745133, 1.0f, -1.9982008594324792, 1.0f, 1.9811618990509388, -0.98421214095557874, 1.0f, -1.9984573022826377, 1.0f, 1.9905135705000845, -0.99141230602687447, 1.0f, -1.9973201934772735, 1.0f, 1.9762591991505425, -0.98079167906854881, 1.0f, -1.9977017531029013, 1.0f, 1.98819633804476, -0.98953475663554691, 1.0f, -1.9960082758339546, 1.0f, 1.9697634228362584, -0.97651219554960678, 1.0f, -1.9965784695983881, 1.0f, 1.985228283682364, - 0.98721477419845893, 1.0f, -1.9940446813536532, 1.0f, 1.9610943822688855, -0.97116965280311218, 1.0f, -1.9949005259244965, 1.0f, 1.9813983390971945, -0.98434426610065295, 1.0f, -1.991075851460911, 1.0f, 1.9498011531520154, -0.96484429010686379, 1.0f, -1.992357774111849, 1.0f, 1.9764587586761948, -0.98086657007901001, 1.0f, -1.9867247661974217, 1.0f, 1.9350376145727821, -0.95731802025700141, 1.0f, -1.9886308030138982, 1.0f, 1.9701617572422605, -0.97670621842043603, 1.0f, -1.9801294973185699, 1.0f, 1.9148047967518167, -0.94799620152026709, 1.0f, -1.9829844086801105, 1.0f, 1.961776396948208, - 0.97153944921734758, 1.0f, -1.9703231999740791, 1.0f, 1.8881250400523037, -0.93724504669517661, 1.0f, -1.9745642037752649, 1.0f, 1.9508067867306931, -0.96539584384207133, 1.0f, -1.9557378664506224, 1.0f, 1.8510163627065761, -0.92377512956542152, 1.0f, -1.9620733199017801, 1.0f, 1.9361423264060851, -0.95778057700941321, 1.0f, -1.9339020469294512, 1.0f, 1.8003998958951306, -0.90790807920986105, 1.0f, -1.9433448844844081, 1.0f, 1.9163788324201381, -0.94856104133872299, 1.0f, -1.9015227841315223, 1.0f, 1.7305300245655038, -0.88882178597321959, 1.0f, -1.915593040848339, 1.0f, 1.8896895587938904, -0.9373010967953127, 1.0f, -1.8531220930814944, 1.0f, 1.6344999241337361, -0.86668056372069557, 1.0f, -1.874026704470682, 1.0f, 1.8530567953888735, -0.92364974387955678, 1.0f, -1.7814233815686635, 1.0f, 1.5024464872516572, -0.84093449044712498, 1.0f, -1.8123877030572753, 1.0f, 1.8027865417958888, -0.90701983708131451, 1.0f, -1.6755078439928464, 1.0f, 1.321831109998016, - 0.81155327371020025, 1.0f, -1.7211755784893521, 1.0f, 1.7334729191768039, -0.88669823138720361, 1.0f, -1.5193909874314595, 1.0f, 1.0767880802192309, -0.77884326208901511, 1.0f, -1.5863675635711973, 1.0f, 1.6374936349129854, -0.86166421094186307, 1.0f, -1.2912156961323573, 1.0f, 1.5047656268215672, - 0.83069896382931541, 1.0f, -1.388345463623992, 1.0f, 0.75145211407834567, -0.7443856043458501, 1.0f, -0.96180244327565756, 1.0f, 1.3227891119121518, - 0.79169129179217435, 1.0f, -1.1003280468884451, 1.0f, 0.33116807649550445, -0.71069729059482578, 1.0f, -0.68686243795047353, 1.0f, 1.0774220682772682, - 0.74111184583268042, 1.0f, -0.49469449078466632, 1.0f, - 0.18861075562716817, -0.68336863103693435, 1.0f,  0.1477121184825711, 1.0f, - 0.78621712704829005, -0.67544424166627159, 1.0f, -0.1047250219416852, 1.0f, 0.7565114661869381, - 0.67273151319408298, 1.0f, 0.98421455391395885, 1.0f, - 1.3993461185775375, - 0.72051362490994464, 1.0f, 0.69245157090599596, 1.0f, 0.36565327554664351, -0.57287354413613123, 1.0f, 1.7727558024090371, 1.0f, -1.9412843057999956, - 0.94569286734955182, 1.0f, 1.9269768220629024, 1.0f, -0.0088668496143469999, -0.41357475277411904, 1.0f, 1.9753286798546643, 1.0f, -1.9997212083262683, - 0.99972130938904791, 1.0f, 1.9999922502074605, 1.0f, -0.50385681339297106, -0.41866392906180916};



		
void GUI_INIT()
{
		unsigned short int i,j;
		POINT_COLOR=RED;
		LCD_ShowString(100,0,100,16,16, "10KHZ");
		POINT_COLOR=RED;
		LCD_DrawRectangle(19,15,281,225);
	
		POINT_COLOR=RED;

		LCD_ShowString(1,208,18,12,12, " -5V");
		LCD_ShowString(1,189,18,12,12, " -4V");
		LCD_ShowString(1,170,18,12,12, " -3V");
		LCD_ShowString(1,151,18,12,12, " -2V");
		LCD_ShowString(1,132,18,12,12, " -1V");
		LCD_ShowString(1,113,18,12,12, "  0V");
		LCD_ShowString(1,94,18,12,12, " 1V");
		LCD_ShowString(1,75,18,12,12, " 2V");
		LCD_ShowString(1,56,18,12,12, " 3V");
		LCD_ShowString(1,37,18,12,12, " 4V");
		LCD_ShowString(1,18,18,12,12, " 5V");
		
		LCD_ShowString(16,218,18,12,12, "0ms");
		LCD_ShowString(66,218,18,12,12, "5ms");
		LCD_ShowString(116,218,24,12,12, "10ms");
		LCD_ShowString(166,218,24,12,12, "15ms");
		LCD_ShowString(216,218,24,12,12, "20ms");
		LCD_ShowString(266,218,24,12,12, "25ms");
		
		POINT_COLOR=RED;
		LCD_ShowString(282,15,30,12,12, "Plock");
		
		POINT_COLOR=RED;
		for(i = 0; i < 7; i++)
			{
				LCD_DrawLine(20 + i * 50, 225, 20 + i * 50, 227);
				
				for(j = 1; j < 5; j++)
				{
					LCD_DrawLine(20 + i * 50 + j * 10, 225, 20 + i * 50 + j * 10, 226);
				}
				POINT_COLOR=RED;
			}
	
}


void GUI_INIT_2()
{
		unsigned short int i,j;
		LCD_Fill(0,0,290,218,WHITE);
		POINT_COLOR=RED;
		LCD_ShowString(100,0,100,16,16, "10KHZ");
		POINT_COLOR=RED;
		LCD_DrawRectangle(19,15,281,225);
	
		POINT_COLOR=RED;

		LCD_ShowString(1,208,18,12,12, " 0V");
		LCD_ShowString(1,170,18,12,12, " 1V");
		LCD_ShowString(1,132,18,12,12, " 2V");
		LCD_ShowString(1,94,18,12,12, " 3V");
		LCD_ShowString(1,56,18,12,12, " 4V");
		LCD_ShowString(1,18,18,12,12, " 5V");
		
		LCD_ShowString(16,218,18,12,12, "0Hz");
		LCD_ShowString(66,218,18,12,12, "5KHz");
		LCD_ShowString(116,218,24,12,12, "10KHz");
		LCD_ShowString(166,218,24,12,12, "15KHz");
		LCD_ShowString(216,218,24,12,12, "20KHz");
		LCD_ShowString(266,218,24,12,12, "25KHz");
		
		POINT_COLOR=RED;
		LCD_ShowString(282,15,30,12,12, "Plock");
		
		POINT_COLOR=RED;
		for(i = 0; i < 7; i++)
			{
				LCD_DrawLine(20 + i * 50, 225, 20 + i * 50, 227);
				
				for(j = 1; j < 5; j++)
				{
					LCD_DrawLine(20 + i * 50 + j * 10, 225, 20 + i * 50 + j * 10, 226);
				}
				POINT_COLOR=RED;
			}
}

void GPIOB_Init(void)
{
 
 GPIO_InitTypeDef  GPIO_InitStructure;
 	
 RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);	 //使能PA,PD端口时钟
	
 GPIO_InitStructure.GPIO_Pin = GPIO_Pin_All;				 //LED0-->PA.8 端口配置
 GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING; 		 //推挽输出
 GPIO_Init(GPIOB, &GPIO_InitStructure);					 //根据设定参数初始化GPIOA.8
 GPIO_SetBits(GPIOB,GPIO_Pin_8);						 //PA.8 输出高
}




 int main(void)
 { 
	u8 t=0;
	u16 adcx;
	int i;
	float temp;
	GPIOB_Init();
	 
	delay_init();	    	//延时函数初始化
	LED_Init();		  	 	//初始化与LED连接的硬件接口
	KEY_Init();         //初始化与按键连接的硬件接口
	LED0=0;					    //点亮LED
	 

	delay_init();	    	//延时函数初始化
	uart_init(9600);	 	//串口初始化为9600
	LED_Init();		  		//初始化与LED连接的硬件接口

 	Adc_Init();		  		//ADC初始化
	Dac1_Init();        //DAC初始化 
	
	while(1)
	{
		t=KEY_Scan(0);		//得到键值
		switch(t)
		{	
			case KEY0_PRES:
			{
				break;
			}
			case KEY1_PRES:
			{
				while(1)
				{
					temppp = Get_Adc(ADC_Channel_1);
					Dac1_Set_Vol(temppp);
				}
			}
			case WKUP_PRES:
			{
				ReadValue = 0;
	      arm_biquad_cascade_df1_init_f32(&S, numStages, (float *)&IIRCoeffs32LP[ReadValue*10], (float *)&IIRStateF32[0]);
				TIM5_Int_Init(79,49);//10Khz的计数频率，计数到5000为500ms
			}
			default:
				delay_ms(10);	
		} 
	}	
}	
